import React from 'react';
import type { NextPage } from 'next'
import Head from 'next/head'
import { Backdrop, CircularProgress, Container } from '@mui/material'

import { useMetaMask } from 'metamask-react'

import { AssetCardData, AssetTable, MetaMaskConnectCard } from '@components';

const assets_connected: Record<string, AssetCardData[]> = {
  '0x4': [
    {
      shortName: 'ETH',
      displayName: 'Ethereum',
      price: 3000.0,
      count: 0.0,

      address: '0x2d71c4144b58c640197EC0970A5bA09C2DfA062a',
    },
    {
      shortName: 'KAL',
      displayName: 'Kal Token',
      price: 0.0,
      count: 100.0,

      address: '0x2d71c4144b58c640197EC0970A5bA09C2DfA062a',
    },
  ],
  '0x1': [
    {
      shortName: 'ETH',
      displayName: 'Ethereum',
      price: 3000.0,
      count: 0.0,

      address: '0x2d71c4144b58c640197EC0970A5bA09C2DfA062a',
    },
  ],
};

const Home: NextPage = () => {
  const { status, connect, account, chainId, ethereum } = useMetaMask();

  const [openBackdrop, setOpenBackdrop] = React.useState(false);
  const [assets, setAssets] = React.useState([] as AssetCardData[]);

  React.useEffect(() => {
    if (status === 'connected') {
      setOpenBackdrop(true);
      const timeout = setTimeout(() => {
        setAssets(assets_connected[chainId]);
        setOpenBackdrop(false);
      }, 1000);
      return () => {
        setAssets([]);
        setOpenBackdrop(false);
        clearTimeout(timeout);
      };
    }
    setAssets([]);
  }, [status, chainId]);

  return (
    <Container>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <Backdrop open={openBackdrop}>
        <CircularProgress />
      </Backdrop>

      <MetaMaskConnectCard />

      <Container style={{ display: status === 'connected' ? 'flex' : 'none' }}>
        <AssetTable assets={assets} />
      </Container>
    </Container>
  )
}

export default Home
